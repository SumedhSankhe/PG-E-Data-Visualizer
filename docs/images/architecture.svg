<svg viewBox="0 0 1200 700" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <!-- Gradients -->
    <linearGradient id="realtimeGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#22d3ee" stop-opacity="0.15"/>
      <stop offset="100%" stop-color="#0891b2" stop-opacity="0.05"/>
    </linearGradient>
    <linearGradient id="batchGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#a78bfa" stop-opacity="0.15"/>
      <stop offset="100%" stop-color="#7c3aed" stop-opacity="0.05"/>
    </linearGradient>
    <linearGradient id="deliverGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#f59e0b" stop-opacity="0.15"/>
      <stop offset="100%" stop-color="#d97706" stop-opacity="0.05"/>
    </linearGradient>
    
    <!-- Arrow markers -->
    <marker id="arrowCyan" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <path d="M0,0 L0,6 L9,3 z" fill="#22d3ee"/>
    </marker>
    <marker id="arrowPurple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <path d="M0,0 L0,6 L9,3 z" fill="#a78bfa"/>
    </marker>
    <marker id="arrowAmber" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <path d="M0,0 L0,6 L9,3 z" fill="#f59e0b"/>
    </marker>
    <marker id="arrowGray" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <path d="M0,0 L0,6 L9,3 z" fill="#64748b"/>
    </marker>
    
    <!-- Grid pattern -->
    <pattern id="grid" width="30" height="30" patternUnits="userSpaceOnUse">
      <path d="M 30 0 L 0 0 0 30" fill="none" stroke="#1e293b" stroke-width="0.5"/>
    </pattern>
    
    <!-- Fonts -->
    <style>
      @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&amp;display=swap');
      text { font-family: 'JetBrains Mono', 'SF Mono', 'Consolas', monospace; }
      .title { font-size: 20px; font-weight: 700; fill: #f1f5f9; }
      .subtitle { font-size: 11px; font-weight: 400; fill: #64748b; }
      .section-label { font-size: 10px; font-weight: 600; fill: #475569; letter-spacing: 2px; }
      .node-title { font-size: 11px; font-weight: 600; fill: #e2e8f0; }
      .node-subtitle { font-size: 9px; font-weight: 400; fill: #94a3b8; }
      .node-detail { font-size: 8px; font-weight: 400; fill: #64748b; }
      .highlight-cyan { fill: #22d3ee; }
      .highlight-purple { fill: #a78bfa; }
      .highlight-amber { fill: #fbbf24; }
      .highlight-green { fill: #4ade80; }
      .legend-text { font-size: 9px; fill: #64748b; }
    </style>
  </defs>
  
  <!-- Background -->
  <rect width="100%" height="100%" fill="#0f172a"/>
  <rect width="100%" height="100%" fill="url(#grid)"/>
  
  <!-- Header -->
  <circle cx="40" cy="35" r="5" fill="#fbbf24">
    <animate attributeName="opacity" values="1;0.5;1" dur="2s" repeatCount="indefinite"/>
  </circle>
  <text x="55" y="40" class="title">PG&amp;E Data Visualizer</text>
  <text x="55" y="58" class="subtitle">Real-time smart meter analytics pipeline</text>
  
  <!-- Section Labels -->
  <text x="100" y="100" class="section-label">DATA SOURCE</text>
  <text x="340" y="100" class="section-label">INGESTION</text>
  <text x="600" y="100" class="section-label">PROCESSING</text>
  <text x="920" y="100" class="section-label">DELIVERY</text>
  
  <!-- ============================================== -->
  <!-- REAL-TIME INGESTION SECTION -->
  <!-- ============================================== -->
  
  <!-- Smart Meter -->
  <rect x="60" y="130" width="140" height="70" rx="4" fill="#0f172a" stroke="#334155" stroke-width="1"/>
  <circle cx="130" cy="152" r="10" fill="none" stroke="#22d3ee" stroke-width="1.5"/>
  <line x1="130" y1="145" x2="130" y2="159" stroke="#22d3ee" stroke-width="1.5"/>
  <line x1="123" y1="152" x2="137" y2="152" stroke="#22d3ee" stroke-width="1.5"/>
  <text x="130" y="178" text-anchor="middle" class="node-title">Smart Meter</text>
  <text x="130" y="192" text-anchor="middle" class="node-detail">15-min intervals</text>
  
  <!-- PG&E API -->
  <rect x="60" y="240" width="140" height="85" rx="4" fill="#0f172a" stroke="#334155" stroke-width="1"/>
  <text x="130" y="268" text-anchor="middle" class="node-title">PG&amp;E Share My Data</text>
  <text x="130" y="285" text-anchor="middle" class="node-detail">Green Button Connect</text>
  <text x="130" y="302" text-anchor="middle" class="node-detail highlight-cyan">mTLS Authentication</text>
  <text x="130" y="317" text-anchor="middle" class="node-detail">ESPI XML Format</text>
  
  <!-- Supabase Edge Function -->
  <rect x="290" y="180" width="180" height="100" rx="4" fill="url(#realtimeGrad)" stroke="#22d3ee" stroke-width="1"/>
  <text x="380" y="208" text-anchor="middle" class="node-title highlight-cyan">Supabase Edge Function</text>
  <text x="380" y="228" text-anchor="middle" class="node-detail">• Webhook receiver</text>
  <text x="380" y="243" text-anchor="middle" class="node-detail">• ESPI XML → JSON</text>
  <text x="380" y="258" text-anchor="middle" class="node-detail">• Signature validation</text>
  <text x="380" y="273" text-anchor="middle" class="node-detail">• Insert to Postgres</text>
  
  <!-- Supabase Postgres -->
  <rect x="290" y="320" width="180" height="80" rx="4" fill="#0f172a" stroke="#334155" stroke-width="1"/>
  <ellipse cx="380" cy="345" rx="22" ry="7" fill="none" stroke="#3b82f6" stroke-width="1"/>
  <line x1="358" y1="345" x2="358" y2="365" stroke="#3b82f6" stroke-width="1"/>
  <line x1="402" y1="345" x2="402" y2="365" stroke="#3b82f6" stroke-width="1"/>
  <ellipse cx="380" cy="365" rx="22" ry="7" fill="none" stroke="#3b82f6" stroke-width="1"/>
  <text x="380" y="388" text-anchor="middle" class="node-title">Supabase Postgres</text>
  
  <!-- Real-time flow arrows -->
  <line x1="130" y1="200" x2="130" y2="235" stroke="#22d3ee" stroke-width="1.5" stroke-dasharray="4 2" marker-end="url(#arrowCyan)"/>
  <path d="M200 280 Q250 250 285 235" fill="none" stroke="#22d3ee" stroke-width="1.5" marker-end="url(#arrowCyan)"/>
  <text x="235" y="245" class="node-detail highlight-cyan">webhook</text>
  <line x1="380" y1="280" x2="380" y2="315" stroke="#22d3ee" stroke-width="1.5" marker-end="url(#arrowCyan)"/>
  
  <!-- ============================================== -->
  <!-- BATCH PROCESSING SECTION -->
  <!-- ============================================== -->
  
  <!-- GitHub Actions Container -->
  <rect x="550" y="130" width="220" height="310" rx="4" fill="url(#batchGrad)" stroke="#a78bfa" stroke-width="1"/>
  <text x="660" y="158" text-anchor="middle" class="node-title highlight-purple">GitHub Actions</text>
  <text x="660" y="175" text-anchor="middle" class="node-detail">Cron: 3 AM UTC daily</text>
  
  <!-- Step 1: Fetch -->
  <rect x="570" y="195" width="180" height="45" rx="3" fill="#1e1b4b" stroke="#4c1d95" stroke-width="0.5"/>
  <text x="580" y="212" class="node-detail">1</text>
  <text x="660" y="215" text-anchor="middle" class="node-subtitle">fetch_and_parse_pge.py</text>
  <text x="660" y="230" text-anchor="middle" class="node-detail">Query unprocessed rows</text>
  
  <!-- Step 2: Process -->
  <rect x="570" y="250" width="180" height="45" rx="3" fill="#1e1b4b" stroke="#4c1d95" stroke-width="0.5"/>
  <text x="580" y="267" class="node-detail">2</text>
  <text x="660" y="270" text-anchor="middle" class="node-subtitle">process_pge_data.R</text>
  <text x="660" y="285" text-anchor="middle" class="node-detail">Merge, dedupe, transform</text>
  
  <!-- Step 3: Commit -->
  <rect x="570" y="305" width="180" height="45" rx="3" fill="#1e1b4b" stroke="#4c1d95" stroke-width="0.5"/>
  <text x="580" y="322" class="node-detail">3</text>
  <text x="660" y="325" text-anchor="middle" class="node-subtitle">git commit + push</text>
  <text x="660" y="340" text-anchor="middle" class="node-detail">SQLite + RDS to repo</text>
  
  <!-- Step 4: Deploy -->
  <rect x="570" y="360" width="180" height="45" rx="3" fill="#1e1b4b" stroke="#4c1d95" stroke-width="0.5"/>
  <text x="580" y="377" class="node-detail">4</text>
  <text x="660" y="380" text-anchor="middle" class="node-subtitle">rsconnect::deployApp()</text>
  <text x="660" y="395" text-anchor="middle" class="node-detail">Deploy if data changed</text>
  
  <!-- Step 5: Mark -->
  <rect x="570" y="415" width="180" height="20" rx="3" fill="#1e1b4b" stroke="#4c1d95" stroke-width="0.5"/>
  <text x="580" y="429" class="node-detail">5</text>
  <text x="660" y="429" text-anchor="middle" class="node-detail">mark_processed.py</text>
  
  <!-- Batch flow arrows -->
  <path d="M470 360 L545 280" fill="none" stroke="#a78bfa" stroke-width="1.5" marker-end="url(#arrowPurple)"/>
  <path d="M545 425 L470 385" fill="none" stroke="#a78bfa" stroke-width="1.5" stroke-dasharray="4 2" marker-end="url(#arrowPurple)"/>
  
  <!-- ============================================== -->
  <!-- DELIVERY SECTION -->
  <!-- ============================================== -->
  
  <!-- shinyapps.io -->
  <rect x="870" y="220" width="200" height="150" rx="4" fill="url(#deliverGrad)" stroke="#f59e0b" stroke-width="1.5"/>
  <text x="970" y="252" text-anchor="middle" class="node-title highlight-amber">shinyapps.io</text>
  <text x="970" y="275" text-anchor="middle" class="node-subtitle">ssankhe.shinyapps.io/</text>
  <text x="970" y="292" text-anchor="middle" class="node-subtitle">PG-E-Data-Visualizer</text>
  <line x1="890" y1="310" x2="1050" y2="310" stroke="#334155" stroke-width="0.5"/>
  <text x="970" y="330" text-anchor="middle" class="node-detail">R/Shiny • bslib • plotly</text>
  <text x="970" y="345" text-anchor="middle" class="node-detail">Anomaly Detection</text>
  <text x="970" y="360" text-anchor="middle" class="node-detail">Cost Optimization</text>
  
  <!-- Deploy arrow -->
  <path d="M770 380 L865 320" fill="none" stroke="#4ade80" stroke-width="1.5" marker-end="url(#arrowAmber)"/>
  <text x="810" y="335" class="node-detail highlight-green">deploy</text>
  
  <!-- User -->
  <circle cx="970" cy="470" r="25" fill="#0f172a" stroke="#334155" stroke-width="1"/>
  <circle cx="970" cy="462" r="8" fill="none" stroke="#64748b" stroke-width="1.5"/>
  <path d="M952 485 Q970 472 988 485" fill="none" stroke="#64748b" stroke-width="1.5"/>
  <text x="970" y="510" text-anchor="middle" class="node-detail">End User</text>
  
  <!-- User arrow -->
  <line x1="970" y1="445" x2="970" y2="375" stroke="#64748b" stroke-width="1" stroke-dasharray="3 3" marker-end="url(#arrowGray)"/>
  
  <!-- ============================================== -->
  <!-- CI/CD SECTION (smaller, bottom) -->
  <!-- ============================================== -->
  
  <rect x="550" y="480" width="220" height="70" rx="4" fill="#0f172a" stroke="#22c55e" stroke-width="1"/>
  <text x="660" y="505" text-anchor="middle" class="node-title highlight-green">CI/CD Pipeline</text>
  <text x="660" y="522" text-anchor="middle" class="node-detail">ci-tests.yml → lintr, testthat, covr</text>
  <text x="660" y="537" text-anchor="middle" class="node-detail">deploy-shinyapps.yml → on merge</text>
  
  <!-- CI/CD to shinyapps arrow -->
  <path d="M770 515 Q850 515 860 400 L865 370" fill="none" stroke="#22c55e" stroke-width="1" stroke-dasharray="4 2" marker-end="url(#arrowAmber)"/>
  
  <!-- ============================================== -->
  <!-- LEGEND -->
  <!-- ============================================== -->
  
  <text x="60" y="600" class="section-label">LEGEND</text>
  
  <line x1="60" y1="625" x2="90" y2="625" stroke="#22d3ee" stroke-width="2"/>
  <text x="100" y="629" class="legend-text">Real-time (webhook push)</text>
  
  <line x1="260" y1="625" x2="290" y2="625" stroke="#a78bfa" stroke-width="2"/>
  <text x="300" y="629" class="legend-text">Batch (cron daily)</text>
  
  <line x1="440" y1="625" x2="470" y2="625" stroke="#22c55e" stroke-width="2"/>
  <text x="480" y="629" class="legend-text">CI/CD (on merge)</text>
  
  <line x1="620" y1="625" x2="650" y2="625" stroke="#64748b" stroke-width="2" stroke-dasharray="4 2"/>
  <text x="660" y="629" class="legend-text">Conditional / async</text>
  
  <!-- Tech Stack Badge -->
  <rect x="870" y="590" width="200" height="50" rx="4" fill="#1e293b" stroke="#334155" stroke-width="0.5"/>
  <text x="970" y="612" text-anchor="middle" class="section-label">TECH STACK</text>
  <text x="970" y="630" text-anchor="middle" class="node-detail">Python • R • Supabase • GitHub Actions</text>
  
  <!-- Footer -->
  <text x="60" y="680" class="subtitle">github.com/SumedhSankhe/PG-E-Data-Visualizer</text>
  <text x="1070" y="680" text-anchor="end" class="subtitle">Architecture v1.0</text>
</svg>
